<!DOCTYPE html>
<html lang="en" xml:lang="en">
  <head>
    <title>Blade Defect Detection</title>
    <style>
      body {
        font-family: Arial;
        margin: 10px 0 0 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
      }
      .result {
        margin-top: 20px;
        font-weight: bold;
        text-align: center;
      }
      .img-preview {
        margin-top: 20px;
        text-align: center;
      }
      .img-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        gap: 30px;
      }
      .input-img {
        width: 100%;
        max-width: 600px;
        height: auto;
        margin: 10px;
        border: 1px solid #ccc;
        display: block;
        box-sizing: border-box;
      }
      @media (max-width: 1100px) {
        .img-row {
          flex-direction: column;
        }
        img {
          max-width: 90vw;
        }
      }
    </style>
    <script>
      function previewImage(input) {
        // Hide uploaded and grad-cam images/titles
        const imgRow = document.querySelector(".img-row");
        if (imgRow) imgRow.style.display = "none";
        // Hide prediction result
        const resultDivs = document.querySelectorAll(".result");
        resultDivs.forEach((div) => {
          if (div.textContent.includes("Prediction:"))
            div.style.display = "none";
        });
        // Show preview of selected image
        const preview = document.getElementById("img-preview");
        preview.innerHTML = "";
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const img = document.createElement("img");
            img.src = e.target.result;
            img.alt = "Uploaded Image";
            img.className = "input-img";
            preview.appendChild(img);
          };
          reader.readAsDataURL(input.files[0]);
        }
      }
    </script>
  </head>
  <body>
    <h2>Upload an Image</h2>
    <form method="post" enctype="multipart/form-data">
      <input
        type="file"
        name="file"
        accept="image/*"
        onchange="previewImage(this)"
        required
      />
      <input type="submit" value="Predict" />
    </form>
    <div id="img-preview" class="img-preview"></div>
    {% if uploaded_url or gradcam_url %}
    <div class="img-row">
      {% if uploaded_url %}
      <div>
        <div class="result">Uploaded Image</div>
        <img
          src="{{ uploaded_url }}?{{ range(1000000)|random }}"
          alt="Uploaded"
          class="input-img"
        />
      </div>
      {% endif %} {% if gradcam_url %}
      <div>
        <div class="result">Grad-CAM Result</div>
        <img
          src="{{ gradcam_url }}?{{ range(1000000)|random }}"
          alt="Grad-CAM Result"
          class="input-img"
        />
      </div>
      {% endif %}
    </div>
    {% endif %} {% if prediction %}
    <div class="result">Prediction: {{ prediction }}</div>
    {% endif %}
  </body>
</html>
